# 卷死你的 Claude Code，让它彻夜干活：ralph loop 插件一手体验

> 来源：小红书 湾仔码农，2025-01-15
> 原文链接：https://www.xiaohongshu.com/explore/69683542000000000b00bacb

## 核心观点

**Ralph Loop 插件让 Claude Code 实现持续循环执行，在有详细 PRD（产品需求文档）和测试用例的场景下，可自动完成数天的人工工作量。**

核心价值：
- 适用场景明确：有详细需求文档和测试用例，但人工执行耗时长的任务
- 自动循环迭代：遇到错误自动修复，直到所有测试通过
- 效率提升显著：Claude Code 之父 Boris 一个月提交 259 个 PR，添加 40000 行代码
- 需要前期准备：详细的 PRD + 完整的测试用例是关键前提

---

## 背景：Claude Code 的自动化困境

Claude Code 之父 Boris 分享了一个数字：

**过去 1 个月内，提交了 259 个 PR，添加了 40000 行代码。**

而这背后，是 Claude Code 不眠不休地在帮他干活。

问题是：怎么让 Claude 持续不间断运行长任务？

答案就是 Anthropic 近期开放的 **ralph loop** 插件（原名 ralph wiggum，因版权原因改名）。

---

## Ralph Loop 的背景故事

### 起源：Geoffrey Huntley 的创意

Ralph Loop 的故事要从一位澳大利亚开发者 Geoffrey Huntley 说起。

Geoffrey 是 Vibe Coding 的践行者，他在使用 Claude Code 的过程中发现了一个问题：**Claude Code 每次完成任务后就停下来，需要人工继续推进**。

于是他想：如果能让 Claude 循环执行任务，遇到错误自动重试，那不就能让它"彻夜干活"了吗？

### 名字的由来

**Ralph Wiggum** 是《辛普森一家》中的角色，以天真、执着、有些"笨笨"但坚持不懈的形象著称。

Geoffrey 用这个名字命名插件，正是取其"不知疲倦地坚持执行"的含义。

后来因为版权原因，插件改名为 **Ralph Loop**，但核心思想没有变：让 AI 循环执行任务，直到完成。

---

## 什么时候适合用 Ralph Loop？

| 场景 | 推荐度 | 说明 |
|------|--------|------|
| 有详细 PRD 和测试用例 | ✅✅✅ | 人工执行耗时长，适合自动化迭代 |
| 需求明确、无模糊地带 | ✅✅ | 边界条件清晰，减少人工干预 |
| 重复性开发任务 | ✅ | 代码重构、批量修改等 |
| 需求探索阶段 | ❌ | 需要频繁决策，不适合循环 |
| 快速原型验证 | ❌ | 迭代方向不确定 |

**核心原则**：
> Ralph loop 最适合的，还是你有了非常详细的 PRD 和测试用例，但人工执行要非常久的场景。

---

## 安装配置

### 安装步骤

```bash
# 1. 添加官方市场
/plugin marketplace add anthropics/claude-code

# 2. 安装插件
/plugin install ralph-loop
```

### 核心参数

| 参数 | 说明 |
|------|------|
| `--max-iterations` | 最大迭代次数，防止无限循环 |
| `--completion-promise` | 完成信号，满足条件时停止 |
| `--continue-on-failure` | 遇错继续，自动修复 |

---

## 终极提示词模板

```
你是一个不知疲倦的开发者，使用 Ralph Loop 循环执行任务，直到所有需求完成。

## 项目背景
{项目描述}

## PRD（产品需求文档）
{详细的 PRD，包含：功能需求、非功能需求、边界条件、验收标准}

## 技术栈
{列出使用的技术栈}

## 测试用例
{列出所有测试用例}

## 工作流程

1. 理解需求：仔细阅读 PRD，确保理解所有需求
2. 制定计划：拆分需求为具体的任务列表
3. 执行任务：按照任务列表逐个实现
4. 运行测试：每完成一个任务，运行相关测试
5. 修复问题：如果测试失败，修复问题后重新测试
6. 继续循环：直到所有测试通过

## 重要原则

- 遇到错误不要停止：分析错误原因，尝试修复，然后继续
- 每完成一个任务就测试：不要等所有任务完成再测试
- 保持日志：记录每个任务的完成情况和遇到的问题
- 不知疲倦：即使需要多次尝试，也要坚持直到完成

开始工作吧！
```

---

## 实战案例：飞书文档转微信公众号排版工具

### 项目背景

使用 Ralph Loop 开发一个将飞书文档转换为微信公众号排版的工具。

### PRD 要点

**功能需求**：
1. 读取飞书文档内容
2. 解析 Markdown 格式
3. 转换为微信公众号支持的格式
4. 处理图片、代码块、表格等特殊元素
5. 提供预览功能

**测试用例**：
- 标题转换测试
- 代码高亮测试
- 图片尺寸适配测试
- 表格格式测试

### 执行过程

| 轮次 | 状态 | 说明 |
|------|------|------|
| 第 1 轮 | ✅ 完成 | 创建项目结构、实现 Markdown 解析 |
| 第 2 轮 | ❌ 失败 | 代码块格式不正确、图片尺寸过大 |
| 第 3 轮 | ✅ 完成 | 修复代码块格式、添加图片压缩功能 |
| ... | 继续 | 迭代优化 |
| 第 30 轮 | ✅ 完成 | 所有测试通过 |

### 结果

- Ralph Loop 经过约 30 轮迭代，在约 2 小时内完成整个工具开发
- 如果人工执行，这个过程可能需要 1-2 天

---

## 最佳实践

### 1. 准备阶段

**写好 PRD 是关键**
- PRD 越详细，Ralph Loop 的效率越高
- 明确每个功能的输入输出
- 列出所有边界条件

**编写完整的测试用例**
- 测试用例是 Ralph Loop 的"导航仪"
- 每个功能都应该有对应的测试
- 测试应该覆盖正常和异常情况

### 2. 执行阶段

**让 Ralph Loop 自主运行**
- 不要中途干预（除非发现方向错误）
- 让它自己尝试解决问题
- 通过日志监控进度

**定期检查进度**
- 每隔一段时间检查日志
- 确认 Ralph Loop 没有陷入死循环
- 必要时调整 PRD 或测试用例

### 3. 收尾阶段

**验收测试**
- 所有测试通过后，进行人工验收
- 检查代码质量
- 验证功能完整性

---

## 常见问题

### Q1: Ralph Loop 会陷入死循环吗？

**A**：有可能。避免方法：
1. 设置 `--max-iterations` 最大迭代次数
2. 编写清晰的测试用例作为终止条件
3. 监控日志，发现循环及时干预

### Q2: Ralph Loop 会自动修复错误吗？

**A**：会的。Ralph Loop 会在测试失败后分析原因，尝试修复问题，然后重新测试。

### Q3: 如何监控 Ralph Loop 的进度？

**A**：
1. 查看日志输出
2. 检查测试通过率
3. 查看代码仓库的提交记录

---

## 总结

| 维度 | 评估 |
|------|------|
| ✅ 适用场景 | 有详细 PRD 和测试用例的重复性开发任务 |
| ✅ 效率提升 | 可将数天工作量压缩到数小时 |
| ✅ 自动化程度 | 循环执行、自动修复、智能迭代 |
| ⚠️ 注意事项 | 需要良好的前期准备（PRD + 测试） |
| ⚠️ 风险提示 | 需要适当监控，避免陷入死循环 |

**终极秘诀**：
> 准备好详细的 PRD 和完整的测试用例，然后让 Ralph Loop "笨笨地坚持"—— 它会在一夜之间完成你可能需要几天才能完成的工作。

---

## 重要建议

1. **结合浏览器自动化测试**：进一步验证效果，避免中间错误无法发现
2. **Token 消耗可控**：人工执行也要花同样的 token，不用太担心
3. **慎用"make it better"**：类似做法可能给你惊喜，也可能写一堆史上雕花的功能

---

## 资源链接

- [Claude Code](https://claude.ai/code)
- [Ralph Loop 插件](https://github.com/anthropics/claude-code-plugins)
- [Geoffrey Huntley](https://github.com/guysie)
