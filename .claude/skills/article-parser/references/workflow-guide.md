# 小红书文章解析详细工作指南

## 完整工作流程

### 第一步：内容类型识别

在开始提取前，判断内容类型：

**方法 1：查看 URL**
- 图文笔记：URL 中不含 `type` 参数或 `type=image`
- 视频笔记：URL 中包含 `type=video`

**方法 2：查看页面**
- 图文笔记：页面包含多张图片轮播
- 视频笔记：页面包含视频播放器

---

## 图文笔记提取流程

### 第二步（图文）：页面分析

1. **列出浏览器页面**
   ```bash
   使用 mcp__chrome-devtools__list_pages 查看当前打开的页面
   ```

2. **选择小红书页面**
   ```bash
   使用 mcp__chrome-devtools__select_page 选择对应的小红书页面索引
   ```

### 第三步（图文）：内容提取

#### 3.1 获取页面快照
```bash
mcp__chrome-devtools__take_snapshot
```
查看页面文本内容，了解文章结构。

#### 3.2 识别图片内容
小红书文章的核心内容通常在图片中：

1. **截取图片**：
   ```bash
   mcp__chrome-devtools__take_screenshot
   ```

2. **提取文字**：
   ```bash
   mcp__4_5v_mcp__analyze_image
   prompt: "提取这张图片中的所有文字内容，保持原有格式和结构"
   ```

3. **多图片处理**：
   - 逐个截取所有图片
   - 按顺序提取文字
   - 拼接成完整内容

### 第四步（图文）：内容整理

#### 4.1 创建正文文件

1. **确定文章 slug**：基于标题生成描述性 slug

2. **创建目录**：
   ```bash
   mkdir -p general/article-slug/images/
   ```

3. **整理内容规则**：
   - 去除转发者评论："大家好"、"关注我"、"点赞收藏"等
   - 保留原创内容：原作者观点、技术要点、引用、比喻
   - 结构化：使用 Markdown 标题（# ## ###）
   - 完整性：确保开头结尾无遗漏

4. **创建正文文件**：`general/article-slug/article-slug.md`
   - 文件命名：小写字母、连字符、描述性
   - 末尾保留：`*来源：原作者信息*`
   - 不包含：元数据引用

#### 4.2 创建元数据文件

参考 `metadata-template.yaml` 模板，创建 `general/article-slug/article-slug.metadata.yaml`

**关键字段**：
- `source.content_type`: "图文笔记"
- `content_file`: 使用相对路径 `./article-slug.md`
- `extraction_date`: 当前日期
- `verification.status`: "completed"（已验证）或 "pending"（待验证）

---

## 视频笔记提取流程

### 第二步（视频）：页面导航

1. **导航到小红书视频页面**
   ```bash
   mcp__chrome-devtools__navigate_page
   type: url
   url: [小红书视频URL]
   ```

2. **等待页面加载完成**
   - 确保视频播放器已加载
   - 视频开始缓冲

### 第三步（视频）：内容提取

#### 3.1 提取文本信息

1. **获取页面快照**
   ```bash
   mcp__chrome-devtools__take_snapshot
   ```

2. **从快照中提取**：
   - 标题（通常在页面顶部）
   - 作者名称和用户ID
   - 内容描述
   - 标签（以 # 开头）
   - 发布时间
   - 互动数据（点赞、收藏、评论）

#### 3.2 提取视频 URL

1. **监听网络请求**
   ```bash
   mcp__chrome-devtools__list_network_requests
   resourceTypes: ["media", "xhr", "fetch"]
   ```

2. **查找视频请求**
   - 在返回的请求列表中查找
   - URL 以 `sns-video-al.xhscdn.com` 开头
   - 文件扩展名为 `.mp4`

3. **获取视频详细信息**
   ```bash
   mcp__chrome-devtools__get_network_request
   reqid: [视频请求的ID]
   ```

4. **从响应中提取**：
   - **视频 URL**：完整的请求 URL
   - **视频格式**：`content-type` 响应头（如：`video/mp4`）
   - **视频大小**：从 `content-range` 计算（如：`bytes 0-390624/6914882` 表示总共 6914882 字节 ≈ 6.6 MB）

**示例视频 URL**：
```
https://sns-video-al.xhscdn.com/stream/1/110/115/01e9647aefec6b11010370019bb081f8d1_115.mp4
```

#### 3.3 可选：提取视频内容

如果视频包含重要教学内容：

1. **观看视频**理解内容
2. **查看评论区**是否有作者或观众的补充说明
3. **记录关键信息**：
   - 教学步骤
   - 代码示例
   - 重要时间点
   - 关键结论

### 第四步（视频）：内容整理

#### 4.1 创建正文文件

**目标受众**：技术人员，需要高效、直接的技术干货。

**内容取舍**：
- ✅ 保留：技术栈、实现流程、核心概念、代码示例、视频链接
- ❌ 删除：观众反馈、互动数据、发布时间、标签、学习建议

**标题优化**：
- 去掉 emoji
- 使用技术化表述

**视频笔记模板**（技术教程类）：

```markdown
# [技术化标题]

**作者**：[作者名称]
**视频**：[观看教程](URL) | [下载 MP4](视频直链)

## 概述

[一句话描述技术内容和应用场景]

## 技术栈

- **[技术1]**：[用途说明]
- **[技术2]**：[用途说明]
- **[技术3]**：[用途说明]

## 实现流程

```
1. [步骤1]
2. [步骤2]
3. [步骤3]
4. [步骤4]
```

## 核心概念

**[概念名称]**：
- [要点1]
- [要点2]
- [要点3]

**注意事项**：
- [技术限制或重要说明]

## 相关资源

- [作者主页](URL)
- [其他资源]
```

**示例对比**：

❌ **旧版本**（包含社交噪音）：
```markdown
# 新流派！Vibe Animation教程公开🎏

**发布时间**：3天前 浙江
**标签**：#minimax

## 观众反馈
- "识别的轨迹跑的乱七八糟"
- "可以参考矢量交互动画圈计神的分享"

## 互动数据
- 点赞：4455
- 收藏：5121
```

✅ **新版本**（技术干货）：
```markdown
# Vibe Animation：AI + 手势识别的矢量动画新流派

**视频**：观看教程 | 下载 MP4

## 技术栈
- **MediaPipe**：手势识别
- **Gemini**：AI 代码生成
- **矢量动画**：鱼骨架运动

## 实现流程
1. AI 生成动画描述
2. 手势录制
3. 代码生成
4. 渲染输出
```

#### 4.2 创建元数据文件

**视频笔记特有字段**：
- `source.content_type`: "视频笔记"
- `content.video_url`: 视频直链
- `content.video_format`: 视频格式（如：`video/mp4`）
- `content.video_size`: 视频大小（如：`6.9 MB`）
- `content.engagement`: 互动数据对象

**示例**：
```yaml
source:
  content_type: "视频笔记"

content:
  video_url: "https://sns-video-al.xhscdn.com/stream/1/110/115/01e9647aefec6b11010370019bb081f8d1_115.mp4"
  video_format: "video/mp4"
  video_size: "6.9 MB"
  engagement:
    likes: "4455"
    favorites: "5121"
    comments: "64"
```

---

## 通用步骤

### 第五步：完整性验证

#### 5.1 图文笔记验证

对照原始网页检查：

1. **开头检查**：标题、作者、背景介绍是否完整
2. **结尾检查**：引用、比喻、总结是否遗漏
3. **中间检查**：技术要点、步骤说明是否齐全
4. **格式检查**：Markdown 结构是否清晰

发现遗漏时，补充内容并更新 `verification.issues_found_and_fixed`。

#### 5.2 视频笔记验证

对照原始视频和页面检查：

1. **视频 URL 验证**：
   - 尝试在浏览器中打开视频 URL
   - 确认视频可以正常播放
2. **文字信息验证**：
   - 标题、作者、描述是否准确
   - 标签是否完整
3. **元数据验证**：
   - 视频格式、大小是否正确
   - 互动数据是否准确
4. **内容验证**（如适用）：
   - 教学步骤是否完整
   - 代码示例是否正确

---

## 常见问题

### 通用问题

**Q: 元数据文件和正文文件命名不一致会有问题吗？**
A: 不会，但建议保持一致便于管理。

**Q: 一天多篇文章如何组织？**
A: 在同一天目录下创建多个文件，用描述性名称区分。

### 图文笔记问题

**Q: 如何判断内容是转发者还是原作者？**
A: 转发者通常有个人化表述（"大家好，我是XX"），原作者内容更客观专业。

**Q: 图片内容提取不完整怎么办？**
A: 使用高分辨率截图，分段提取，手动拼接。

### 视频笔记问题

**Q: 视频使用 blob URL 无法直接下载怎么办？**
A: 必须通过监听网络请求获取真实 URL，无法从 blob URL 直接提取。

**Q: 视频内容太多无法全部记录怎么办？**
A: 记录关键时间点和内容摘要，在元数据中注明需要观看视频。

**Q: 视频无法加载怎么办？**
A: 可能需要登录或页面有反爬措施，尝试刷新页面或检查网络请求。

**Q: 如何提取视频中的代码？**
A: 观看视频暂停在代码显示处截图，然后使用图片识别提取文字。

**Q: 评论区的内容要全部保留吗？**
A: 不需要。只提取技术相关内容（技术栈、实现细节、作者补充），忽略观众反馈和讨论热度。

**Q: 需要保留点赞、收藏等互动数据吗？**
A: 不需要。目标受众是技术人员，这些社交数据没有价值。

**Q: 标题中的 emoji 要保留吗？**
A: 删除 emoji，使用技术化表述。例如："教程🎏" → "技术原理与实现"

---

## 示例

### 图文笔记示例
- 正文：`articles/2025-01-11/claude-code-31-tips.md`
- 元数据：`metadata/2025-01-11/claude-code-31-tips.yaml`

### 视频笔记示例
- 正文：`general/2026-01-16/vibe-animation-tutorial.md`
- 元数据：`general/2026-01-16/vibe-animation-tutorial.yaml`

**说明**：该示例展示了如何从技术教程视频中提取技术栈、实现流程，并删除社交噪音（观众反馈、互动数据等）。

---

## 工具参考

提取过程中使用的主要 Chrome DevTools 工具：

| 工具 | 用途 | 适用类型 |
|------|------|----------|
| `list_pages` | 列出浏览器页面 | 通用 |
| `select_page` | 选择工作页面 | 通用 |
| `navigate_page` | 导航到URL | 视频 |
| `take_snapshot` | 获取页面文本快照 | 通用 |
| `take_screenshot` | 截取屏幕截图 | 图文 |
| `list_network_requests` | 列出网络请求 | 视频 |
| `get_network_request` | 获取请求详情 | 视频 |
| `mcp__4_5v_mcp__analyze_image` | 图片识别文字 | 图文 |
